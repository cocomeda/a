<!DOCTYPE html>
<html>
<head>
  <title>くじ引き</title>
  <script src="https://static.line-scdn.net/liff/edge/liff.min.js"></script>
  <script>
    function initializeApp() {
      liff.init({ liffId: "1657196041-vDWabr0g" })
        .then(() => {
          liff.getIDToken()
            .then(idToken => {
              fetch('https://script.google.com/macros/s/AKfycbzZ8X72AXxOFz1nJuFr5I1oPR40kb46EG5XFwHa56mY_VaB_fn4UfuWqnGQ4fHG9XkM-g/exec?idToken=' + encodeURIComponent(idToken), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/x-www-form-urlencoded'
                }
              })
              .then(response => response.json())
              .then(data => {
                if (data.status === 'success') {
                  alert('抽選結果: ' + data.result);
                } else {
                  alert('エラー: ' + data.message);
                }
              })
              .catch(error => {
                console.error('通信エラー:', error);
                alert('通信エラーが発生しました。');
              });
            })
            .catch(err => {
              console.error('IDトークン取得エラー:', err);
              alert('IDトークン取得エラーが発生しました。');
            });
        })
        .catch(err => {
          console.error('LIFF初期化エラー:', err);
          alert('LIFF初期化エラーが発生しました。');
        });
    }
  </script>
</head>
<body>
  <h1>くじ引き</h1>
  <button onclick="initializeApp()">くじ引き</button>
</body>
</html>

